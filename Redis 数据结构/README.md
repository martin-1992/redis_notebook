### 底层数据结构
　　Redis 底层数据结构有 6 种，分别如下。

- **简单动态字符串（SDS），** 以处理二进制的方式来保存数据。不仅可以保存文本数据，还可以保存图片、音频、视频等二进制数据；
- **双向链表（linkedlist），** 广泛用于实现 Redis 的各种功能。比如列表键、发布与订阅、慢查询、监视器等，列表对象的底层实现之一就是链表；
- **字典（hashtable），** 被广泛用于实现 Redis 的各种功能，包括键空间和哈希对象；
    1. Redis 的数据库是用字典作为底层来实现的，字典也是哈希键的底层实现之一；
    2. 其底层由数组 + 单向链表（哈希冲突时，单向链表是将冲突键添加到头节点）实现。数组大小同样为 2 的次方，便于计算索引下标；
    3. 哈希冲突时，使用链表来解决；
    4. 在扩容或缩容时会用到渐进式 rehash，分成多次将值哈希到新表，每次对字典执行添加、删除、查找或更新操作时，会顺便哈希到新表，保证不影响 redis 的性能，避免一次 rehash 造成巨大计算量；
    5. 扩容大小为当前容量 * 2，但需满足 2 的次方。比如 5 * 2 = 10，则新字典大小为 16。
- **跳表（skiplist），** Redis 使用跳表作为有序集合对象的底层实现之一；
    1. 是一种有序的数据结构，通过在每个节点中维持多个指向其它节点的指针，从而达到快速访问节点的目的；
    2. 跳表支持平均 O(logN)、最坏 O(N) 复杂度的节点查找，还可通过顺序性操作来批量处理节点；
    3. Redis 只在两个地方用到跳表，一个是实现有序集合键，另一个是在集群节点中用作内部数据结构；
- **整数集合（intset），** 用于保存整数值的集合抽象数据结构，是集合键的底层实现之一；
    1. 整数集合的底层实现为数组，这个数组以有序、无重复的方式保存集合元素；
    2. 当一个集合只包含整数值元素，并且这个集合的元素数量不多时，就会使用整数集合作为集合键的底层实现；
    3. 整数集合可以保存类型为 int16_6、int32_t 或 int64_t 的整数值，并且集合中不会出现重复元素；
    4. 只支持升级，不支持降级。比如添加 int64_t 时才会升级为 int64_t 的数组，平常为 int16_t 数组。
- **压缩列表（ziplist），** 是列表键和哈希键的底层实现之一，为了节约内存开发的，由一系列特殊编码的连续内存块组成的顺序型数据结构；
    1. 如果一个列表只包含少量列表项，并且每个列表项要么是小整数值，要么是长度比较短的字符串，会使用压缩列表来做列表键的底层实现；
    2. 哈希键也是，只包含少量键值对，并且键和值是小整数值或长度比较短的字符串。

### Redis 对象
　　基于上面提到的 6 种数据结构，构建对象系统，有 5 种。

- **字符串对象，** 可为 int、raw 或 embstr；
    1. 字符串对象保存的是整数值，且用 long 类型表示，则该字符串对象的编码设置为 int；
    2. 保存的是字符串值，且该字符串值长度大于 32 字节，则使用 SDS 来保存，编码设置为 raw；
    3. 保存的是字符串值，且该字符串值长度小于等于 32 字节，则使用 embstr 编码。
- **列表对象，** 底层为压缩列表 ziplist 或双向链表 linkedlist；
    1. 列表对象保存的所有字符串元素的长度都小于 64 字节或列表对象保存的元素数量小于 512 个，使用压缩列表；
    2. 以上条件不满足，则原本保存在压缩列表里的所有列表元素会转移并保存到双端链表里。
- **哈希对象，** 底层为压缩列表 ziplist 或字典 hashtable；
    1. 列表对象保存的所有字符串元素的长度都小于 64 字节或列表对象保存的元素数量小于 512 个，使用压缩列表；
    2. 以上条件不满足，则使用字典。
- **集合对象，** 底层为整数集合 intset 或字典 hashtable；
    1. 集合对象保存的所有元素都是整数值，或集合对象保存的元素数量不超过 512 个，使用整数集合；
    2. 以上条件不满足，则使用字典。
- **有序集合对象，** 底层为压缩列表 ziplist 或跳表 skiplist；
    1. 有序集合保存的元素数量小于 128 个，或保存的所有元素成员的长度都小于 64 字节，使用压缩列表；
    2. 以上条件不满足，则使用跳表。
